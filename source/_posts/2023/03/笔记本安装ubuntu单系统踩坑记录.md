---
title: 笔记本安装ubuntu单系统踩坑记录
date: 2023-03-17 15:34:27
tags:
  - ubuntu
  - 系统安装
  - 踩坑
category: 技术-记录
---

最近把大学时候用的独显笔记本翻出来重新安装了一套Ubuntu系统，没想到坑还挺多的，特别在此记录一下

## 一、关于电脑配置

我的老笔记本是神舟战神Z7M-KP7GT，祖传蓝天公模，主板bios都没技术服务的那种。机器详细配置cpu为i7-7700HQ，显卡1050ti，内存8+16G，
存储的情况稍微复杂一些，简单来说现在电脑里是原装的128G固态和全新1T西数蓝盘，老的机械盘和承载win10系统的500G西数SN500固态都卸下来放一边。

也就是说目前电脑里的两个存储盘都是空盘。因为我想这次直接放弃在这个老本子上安装Windows系统，装成一台纯粹的ubuntu。老的存储准备再重新找个准系统扔进去。

Ubuntu系统选择的22.04LTS，装新不装旧，主打一手折腾，而且这台机器后面打算跑cvat和labelimg，考虑到现在pytorch和cuda的迭代，新版可能反而比旧的能少折腾一些吧。

## 二、开机卡logo

找个U盘做系统盘，随便找个烧录软件做一下就好。

bios改一下boot顺序，进入U盘。选择第一条Try or Install Ubuntu，刚进去就碰到了第一个bug：在刚刚显示logo界面的时候，转圈圈转着转着就卡死，风扇也被拉满呜呜响。

以前装双系统的时候就碰到过类似的问题，按照网上说的在grub界面按e进入命令行，在`quiet splash`后面删去`---`并改为`nomodeset`是不管用的。应当把`nomodeset`修改为`acpi=off`，再按下F10，这样就可以正常进入安装流程了。

另外在安装的流程中要么勾选为无线和图形硬件安装第三方驱动软件，要么进入系统后在`软件和更新`-`附加驱动`中勾选想要安装的N卡驱动，首次进入grub时也不能忘记增加`acpi=off`，在N卡驱动成功安装之后就不需要这个设置了，所以不需要专门修改grub配置将`acpi=off`设置为永久。

## 三、系统分区

因为两个盘都是空盘，我直接对选择了清除整个磁盘并安装的选项，让系统自行分区。但是很快安装过程中就出现了一个非常严重的bug:

> grub-install /dev/sda 失败，这是一个致命错误

这个错误折磨了我两天时间，期间我换了无数种分区方案，什么`/boot`、`BIOS保留空间`都试了个遍，最后摆烂到让系统自己决定。可惜这个bug似乎与分区没什么关系。

不过经过两天的研究，我发现其实现在ubuntu的系统分区不需要像以前那么麻烦了，只需要一个500M左右的efi引导分区和一个挂载点为`/`的根目录分区就可以。

## 四、Grub错误

刚才提到的grub安装失败，原因大概率是主板使用的引导方式和U盘制作时选择的引导方式不同导致。众所周知现在市面上主流的引导方式是UEFI+GPT，老机子则使用的Legacy+MBR，在制作引导盘时，我使用的rufus软件提供了两种选择，我都拿去做了尝试，但是都发生了同样的错误。那么问题在哪里呢？

其实是主板问题，开头的时候我提到过，这款机子采用的是蓝天的公模，同样的，主板也是蓝天的主板。然而，在这个主板的BIOS中并没有提供UEFI引导选择，也就是各种博文中提到的`选择UEFI或者Legacy引导方式`，主板中只提供了一个选项，`UEFI Boot Enabled or Disabled`。但是即便是禁用了UEFI引导，安装时仍旧会抛出同样的问题，我严重怀疑是系统在安装时的指令也存在一定的问题，在我手动`grub-install`时候，系统会抛出错误找不到efi文件，猜测可能是grub写入的方式，刚好和主板能够提供的引导方式岔开。当然我还有一层怀疑是以前在安装双系统的时候折腾的东西影响到了主板的bios，不幸的是这款主板在蓝天官网上已经没有可以拿来重装bios的资料文件了（好惨的版本）

就在我为如何安装系统头疼不已的时候，突然翻到的关于虚拟机的博文给了我灵感：**既然这个主板不能安装，那为什么不换个机子安装呢？**

于是，我把固态拆了下来放到硬盘盒里，通过工作机切入主板，进入引导盘设定安装一气呵成，成了！

但是在安装程序成功弹出`安装成功！请重启系统`的提示的时候，我怀着激动的心，伸着颤抖的手，做了一件非常愚蠢的事情：就在重启再次进入bios的时候，我把装着系统的固态盘拔下来了！想也没想就直接拔了！

既然已经拔了，冷静下来的我选择直接将固态安装回笔记本上，不幸的事终究发生了，虽然系统正确的安装在了固态盘上，但是EFI引导分区似乎并没有正确的安装完全，进入系统迎面而来的就是grub命令行界面

考虑到系统文件都已经正确写入到固态盘中，理论上现在只需要修复grub就可以成功安装。首先尝试直接通过grub命令行修复，结果`ls`之后发现引导分区里只有一个`/efi`的文件夹，根本没有想要的`/grub`文件夹。于是我重新进入U盘引导盘系统，选择`Try Ubuntu`进入图形界面，安装上了`boot repair`工具
``` bash
sudo add-apt-repository ppa:yannubuntu/boot-repair && sudo apt update
sudo apt install -y boot-repair && boot-repair
```
进入`boot repair`界面之后也不需要什么`advanced options`，直接用`recommend`进行修复就行，修复成功后重启系统进入ubuntu，别忘了加上`acpi=off`，进入成功，万事大吉！

## 开始享用Ubuntu吧！

以上就是本人在这周来来回回折腾ubuntu的结果，`acpi=off`这条指令也是从鸟哥的私房菜里面翻到的，只能说有时候搜索引擎不如直接翻书来的准确吧，毕竟网上的博文特别是csdn都是各种各样的坑。

带独显的笔记本安装ubuntu总是会在驱动上被卡很久，主板也可能出各种各样奇奇怪怪的bug，希望未来这方面的问题能够少些吧，每次安装都被搞一手真的是头大。

